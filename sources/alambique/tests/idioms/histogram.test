#!/bin/bash -p
__top=${0%/*}/../..
export PATH="${__top}/bin:$PATH"
__dirname=${0%/*}
exe=flow-alambique
name=${0##*/} ; name=${name%.test}
#
readonly DATA=(1 2 3 4)
readonly BOUNDARIES=1,2,3
readonly EXPECTED="\
0: 0
1: 1
2: 1
3: 0
4: 0
5: 0
6: 0
7: 0
8: 0
9: 2"
#
af=$(echo ${DATA[@]} | tr ' ' '\n' | ${exe?} --af --function=${name?} --boundary-series=${BOUNDARIES?} --measurements=/dev/stdin)
daf=$(echo ${DATA[@]} | tr ' ' '\n' | ${exe?} --daf --function=${name?} --boundary-series=${BOUNDARIES?} --measurements=/dev/stdin)
vdaf=$(echo ${DATA[@]} | tr ' ' '\n' | ${exe?} --vdaf --function=${name?} --boundary-series=${BOUNDARIES?} --measurements=/dev/stdin)
#
set -e
test "${EXPECTED?}" == "${af?}"
test "${EXPECTED?}" == "${daf?}"
test "${EXPECTED?}" == "${vdaf?}"
