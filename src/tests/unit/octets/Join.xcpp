// This is -*- c++ -*- nearly C++23 with Modules TS but in the S.C.O.L.D. stylings that are so popular these days.
// Copyright Yahoo Inc.
// Licensed under the terms of the Apache-2.0 license.
// For terms, see the LICENSE file at https://github.com/yahoo/tunitas-keyston/blob/master/LICENSE
// For terms, see the LICENSE file at https://git.tunitas.technology/all/components/keyston/tree/LICENSE
#divert <fpp>
namespace tests::unit::octets { struct Join; }
#endiv
#divert <hpp>
#import tests.unit.octets.Palette
struct tests::unit::octets::Join : public rigging::suite::Fixture, protected Palette {
  static auto suite() -> Suite;
  //
  template<unsigned> auto test_variable() -> void;
  template<unsigned> auto test_fixed() -> void;
protected:
  inline static constexpr auto const WIDTH = 10uz;
};
#endiv
#divert <cpp>
//
// The specializations MUST occur before suite() so that their address is known
//
#import tunitas.keyston.octets.join
namespace tests::unit::octets {
  template<> auto Join::test_variable<0>() -> void {
    auto got = library::join(generate2<WIDTH>(0)); // <--------------- test this
    require(ASSERTION, 0 == got.size());
  }
  template<> auto Join::test_variable<1>() -> void {
    auto got = library::join(generate2<WIDTH>(2)); // <--------------- test this
    require(ASSERTION, 2*WIDTH == got.size());
  }
  template<> auto Join::test_variable<2>() -> void {
    auto got = library::join(generate2<WIDTH>(4)); // <--------------- test this
    require(ASSERTION, 4*WIDTH == got.size());
  }
  template<> auto Join::test_variable<3>() -> void {
    auto got = library::join(generate2<WIDTH>(6)); // <--------------- test this
    require(ASSERTION, 6*WIDTH == got.size());
  }
  namespace {
    inline constexpr auto const COUNT_VARIABLE = 4uz;
  }
  template<> auto Join::test_fixed<0>() -> void {
    auto got = library::join(generate2<0, WIDTH>()); // <------------- test this
    require(ASSERTION, 0 == got.size());
  }
  template<> auto Join::test_fixed<1>() -> void {
    auto got = library::join(generate2<2, WIDTH>()); // <------------ test this
    require(ASSERTION, 2*WIDTH == got.size());
  }
  template<> auto Join::test_fixed<2>() -> void {
    auto got = library::join(generate2<4, WIDTH>()); // <---------- -- test this
    require(ASSERTION, 4*WIDTH == got.size());
  }
  template<> auto Join::test_fixed<3>() -> void {
    auto got = library::join(generate2<6, WIDTH>()); // <-------------- test this
    require(ASSERTION, 6*WIDTH == got.size());
  }
  namespace {
    inline constexpr auto const COUNT_FIXED = 4uz;
  }
}
#import tunitas.sequence.Sequence
#import std.to_string
auto tests::unit::octets::Join::suite() -> Suite {
  auto series = Stream{"join"sv};
  series << []{
             auto var = Stream{"variable"sv};
             [&var]<Size... INDEX>(::tunitas::sequence::Sequence::Pack<INDEX...>) {
               ((var << add(std::to_string(INDEX), &Join::test_variable<INDEX>)), ... );
             }(::tunitas::sequence::Sequence::make<COUNT_VARIABLE>());
             return var;
           }()
         << []{
             auto fix = Stream{"fixed"sv};
             [&fix]<Size... INDEX>(::tunitas::sequence::Sequence::Pack<INDEX...>) {
               ((fix << add(std::to_string(INDEX), &Join::test_fixed<INDEX>)), ... );
             }(::tunitas::sequence::Sequence::make<COUNT_FIXED>());
             return fix;
           }()
         << END;
    return settle(series);
}
#endiv
